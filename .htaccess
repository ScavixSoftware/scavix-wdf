#
# This htaccess comes into play if you have the WDF accessible from the Internal directly
# We recommend to do so with an own (sub-)domain and not to put it's folder into your
# application folder. Note that the WDF_FEATURES_* env vars are not set here, as WDF
# will only be accessible for resource delivery, not for direct access to any PHP logic!
#

RewriteEngine On

# redirect NoCache files to the real ones
RewriteRule (.*)_nc=([0-9]+)/(.*)\?(.*) $1$3&_nc=$2 [L,QSA]
RewriteRule (.*)_nc=([0-9]+)/(.*) $1$3?_nc=$2 [L,QSA]
RewriteRule (.*)nc([0-9]+)/(.*)\?(.*) $1$3&_nc=$2 [L,QSA]
RewriteRule (.*)nc([0-9]+)/(.*) $1$3?_nc=$2 [L,QSA]

<Files ~ "\.log">
 Order allow,deny
 Deny from all
</Files>

# deny access to some folders via http/s
RewriteCond %{REQUEST_URI} /base/ [OR]
RewriteCond %{REQUEST_URI} /essentials/ [OR]
RewriteCond %{REQUEST_URI} /lib/ [OR]
RewriteCond %{REQUEST_URI} /modules/ [OR]
RewriteCond %{REQUEST_URI} /reflection/ [OR]
RewriteRule .* - [F]

############# performance optimization #####################
<IfModule mod_deflate.c>
<FilesMatch "(\.(js|css|html|jpg|jpeg|png|gif|php))|(\_js\.php)$">
SetOutputFilter DEFLATE
</FilesMatch>
</IfModule>

<FilesMatch "(\.(ico|pdf|flv|jpg|jpeg|png|gif|js|css|swf|gz))|(\_js\.php)?$">
Header unset ETag
FileETag None
</FilesMatch>

<FilesMatch "\_js\.php$">
Header unset Pragma
Header unset Cache-Control
</FilesMatch>

################ Expires Control ################
ExpiresActive On
ExpiresDefault A0
<FilesMatch "\.(gif|jpg|jpeg|png|swf|ico)$">
    ExpiresDefault "now plus 5 weeks"
    Header append Cache-Control "public"
</FilesMatch>
<FilesMatch "\.(xml|txt|html)$">
    ExpiresDefault "now plus 2 hours"
    Header append Cache-Control "proxy-revalidate"
</FilesMatch>
<FilesMatch "(\.(js|css))|(\_js\.php)$">
    ExpiresDefault "now plus 5 weeks"
    Header append Cache-Control "proxy-revalidate"
</FilesMatch>

# allow cookies in IE iframe:
Header set P3P: "CP=\"SCAVIX-WDF\""